<template>
  <tabs ref="tabs">
    <tab :title="$t('IRONSWORN.MOVE.Title')">
      <Suspense>
        <sf-movesheetmoves ref="movesTab" :toolset="toolset" />
      </Suspense>
    </tab>
    <tab :title="$t('IRONSWORN.ORACLE.Title')">
      <Suspense>
        <sf-movesheetoracles ref="oraclesTab" :toolset="toolset" />
      </Suspense>
    </tab>
  </tabs>
</template>

<script lang="ts" setup>
import Tab from './components/tabs/tab.vue'
import Tabs from './components/tabs/tabs.vue'
import SfMovesheetmoves from './components/sf-movesheetmoves.vue'
import SfMovesheetoracles from './components/sf-movesheetoracles.vue'
import { computed, inject, nextTick, provide, ref } from 'vue'
import { CharacterDataProperties } from '../actor/actortypes'
import { $EmitterKey } from './provisions'

const props = defineProps<{
  actor: CharacterDataProperties
  toolset: 'ironsworn' | 'starforged'
}>()

provide(
  'actor',
  computed(() => props.actor)
)

const $emitter = inject($EmitterKey)
// $emitter?.on('*', (...args) => console.log(...args))

const tabs = ref<InstanceType<typeof Tabs>>()
const movesTab = ref<InstanceType<typeof SfMovesheetmoves>>()
$emitter?.on('highlightMove', () => tabs.value?.selectIndex(0))

const oraclesTab = ref<InstanceType<typeof SfMovesheetoracles>>()
$emitter?.on('highlightOracle', () => tabs.value?.selectIndex(1))
</script>
